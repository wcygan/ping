# Improvements

1. (Server) Use [ko](https://github.com/ko-build/ko) instead of Dockerfile
2. (Skaffold) deploy Kafka and Postgres simultaneously
3. (Kafka + Flink) add ordering so that Flink deploys only after Kafka is ready

## Ko

```bash
ko build ./
```

Error:

```bash
Error: error creating publisher: KO_DOCKER_REPO environment variable is unset
```

Fix:

```bash
wcygan@foobar server % export KO_DOCKER_REPO=ko.local
wcygan@foobar server % ko build ./                   
2024/10/27 09:52:00 Using base cgr.dev/chainguard/static:latest@sha256:1c785f2145250a80d2d71d2b026276f3358ef3543448500c72206d37ec4ece37 for github.com/wcygan/ping/server
2024/10/27 09:52:01 git doesn't contain any tags. Tag info will not be available
git is in a dirty state
Please check in your pipeline what can be changing the following files:
 M notes/2024/10/27/09:45:52-CDT.md
 D server/Dockerfile

2024/10/27 09:52:01 Building github.com/wcygan/ping/server for linux/amd64
2024/10/27 09:52:06 Loading ko.local/server-1ce7b56fb4673da1e362ee6584ee6761:fa820ebdae301c737cdf5e60dec228ffdb8a73a24f6fbc11d983e619773d1782
2024/10/27 09:52:07 Loaded ko.local/server-1ce7b56fb4673da1e362ee6584ee6761:fa820ebdae301c737cdf5e60dec228ffdb8a73a24f6fbc11d983e619773d1782
2024/10/27 09:52:07 Adding tag latest
2024/10/27 09:52:07 Added tag latest
ko.local/server-1ce7b56fb4673da1e362ee6584ee6761:fa820ebdae301c737cdf5e60dec228ffdb8a73a24f6fbc11d983e619773d1782
```
